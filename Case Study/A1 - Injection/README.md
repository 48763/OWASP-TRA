# A1 Injection

### 威脅代理：

考慮任何可能發送不可信任的數據（資料）到系統，包含外部用戶、公司夥伴，以及任何系統內部用戶和管理員。

### 攻擊向量：利用非常簡單

攻擊者發送簡單的文字攻擊，利用目標的直譯器語法。幾乎任何資料來源都可能是注入向量（Injection Vector） ，包含內部來源。

### 安全弱點：普遍流行、檢測性平均

注入漏洞發生在應用程序發送不可信任的數據（資料）到直譯器。注入漏洞非常流行，尤其是遺留編碼（Legacy Code）中。這普遍在 SQL、LDAP、XPath 或 NoSQL 請求；系統指令；XML 解析器、SMTP 標頭或表達是語言（Expression Language）...等。注入漏洞在檢驗編碼時非常容易發現，但經常在通過測試時難以發現，掃描器和模糊器可以幫助攻擊者發現注入（Injection）漏洞。

### 技術影響：影響嚴重

注入（Injection）可導致資料的遺失或損壞，缺乏帳戶權限或拒絕存取，注入有時可能導致主機完全被接管。

### 商業影響：應用/業務特定

考慮受影響的資料（數據）和運行直譯器平台的商業價值，全部的資料可能會被偷竊、修改或刪除。你的商譽可能會受到怎樣的影響？

### 我容易受到注入？

找出應用程序容易受到注入的最好方法，就是驗證所有的直譯器使用，並明確地將指令或查詢構成的不可信任數據（資料）分開。在許多的案例中，如果可以的話，推薦避免直譯器或關閉它（例如：XEE），像 SQL 調用（SQL calls）下，把所有準備好的語法或儲存程序都結合變數，或避免動態查詢。

檢查編碼，查看應用程序使用直譯器是否安全，是個快速又準確的方法。編碼分析工具可以幫助安全分析師，找到所使用的直譯器以及追蹤通過應用程序的資料（數據）串流。滲透測試人員可以開發利用已確認的漏洞來驗證這些問題。

在應用程序上使用自動化動態掃描，能提供觀察可利用的注入漏洞是否存在。掃瞄器很難一直在直譯器上檢測攻擊是否成功，而較差的錯誤使用，可以使注入漏洞簡單地被發現。

### 我該如何預防？

預防注入必需保持由指令和查詢所組成的數據分開。
1. 最好的選項是使用安全的 API， 來避免完全使用直譯器或提供參數的介面。小心使用 API，像是儲存程序已經參數化，但仍有可能在這之下引發注入。

2. 如果一個參數化的 API 不能使用，你應該使用直譯器的特殊跳脫句法來謹慎跳脫字元。OWASP 的 Java 編碼和類似的函式庫提供這類跳脫規則。

3. 也推薦積極 或 白名單（white list）輸入驗證，但並不能完全防禦許多允許特殊字元的情況。如果需要特殊字元的話，可以使用上述 1. 和 2. 的方法使其安全。OWASP 的 ESAPI 有一個可擴展的白名單輸入驗證規則函式庫。
